Binary files binutils-2.21.1.orig/.libtool.m4.swp and binutils-2.21.1-addhaiku/.libtool.m4.swp differ
diff -uNr binutils-2.21.1.orig/bfd/config.bfd binutils-2.21.1-addhaiku/bfd/config.bfd
--- binutils-2.21.1.orig/bfd/config.bfd	2011-04-01 07:02:42.000000000 -0500
+++ binutils-2.21.1-addhaiku/bfd/config.bfd	2011-08-23 19:21:47.000000000 -0500
@@ -281,7 +281,7 @@
     ;;
   arm-*-elf | arm-*-freebsd* | arm*-*-linux-* | arm*-*-conix* | \
   arm*-*-uclinux* | arm-*-kfreebsd*-gnu | \
-  arm*-*-eabi* )
+  arm*-*-eabi* | arm*-*-haiku*)
     targ_defvec=bfd_elf32_littlearm_vec
     targ_selvecs=bfd_elf32_bigarm_vec
     ;;
@@ -641,6 +641,11 @@
     targ_selvecs="bfd_elf32_i386_vec i386linux_vec i386pei_vec x86_64pei_vec bfd_elf64_l1om_vec"
     want64=true
     ;;
+  x86_64-*-haiku*)
+    targ_defvec=bfd_elf64_x86_64_vec
+    targ_selvecs="bfd_elf32_i386_vec"
+    want64=true
+    ;;
   x86_64-*-mingw*)
     targ_defvec=x86_64pe_vec
     targ_selvecs="x86_64pe_vec x86_64pei_vec bfd_elf64_x86_64_vec bfd_elf64_l1om_vec i386pe_vec i386pei_vec bfd_elf32_i386_vec"
@@ -679,6 +684,9 @@
     targ_defvec=bfd_elf32_i386_vec
     targ_selvecs="i386pe_vec i386pei_vec"
     ;;
+  i[3-7]86-*-haiku*)
+    targ_defvec=bfd_elf32_i386_vec
+    ;;
   i[3-7]86-*-interix*)
     targ_defvec=i386pei_vec
     targ_selvecs="i386pe_vec"
@@ -870,7 +878,10 @@
     targ_selvecs=ieee_vec
     targ_underscore=yes
     ;;
-
+  m68*-*-haiku*)
+    targ_defvec=bfd_elf32_m68k_vec
+    targ_selvecs="m68kcoff_vec ieee_vec"
+    ;;
   m88*-harris-cxux* | m88*-*-dgux* | m88*-*-sysv4*)
     targ_defvec=bfd_elf32_m88k_vec
     targ_selvecs=m88kbcs_vec
@@ -914,6 +925,10 @@
     targ_defvec=bfd_elf32_tradlittlemips_vec
     targ_selvecs="bfd_elf32_tradbigmips_vec bfd_elf64_tradbigmips_vec bfd_elf64_tradlittlemips_vec ecoff_little_vec ecoff_big_vec"
     ;;
+  mips*el-*-haiku*)
+    targ_defvec=bfd_elf32_littlemips_vec
+    targ_selvecs="bfd_elf32_bigmips_vec bfd_elf64_bigmips_vec bfd_elf64_littlemips_vec ecoff_little_vec ecoff_big_vec"
+    ;;
   mips*-*-netbsd*)
     targ_defvec=bfd_elf32_tradbigmips_vec
     targ_selvecs="bfd_elf32_tradlittlemips_vec bfd_elf64_tradbigmips_vec bfd_elf64_tradlittlemips_vec ecoff_big_vec ecoff_little_vec"
@@ -1157,6 +1172,11 @@
     targ_selvecs="mach_o_be_vec mach_o_le_vec mach_o_fat_vec pef_vec pef_xlib_vec sym_vec"
     targ_archs="$targ_archs bfd_i386_arch"
     ;;
+  powerpc-*-haiku*)
+    targ_defvec=bfd_elf32_powerpc_vec
+    targ_selvecs="rs6000coff_vec bfd_elf32_powerpcle_vec pef_vec pef_xlib_vec pmac_xcoff_vec ppcboot_vec"
+    targ_cflags=-D__HAIKU_TARGET__
+    ;;
   powerpc-*-macos*)
     targ_defvec=pmac_xcoff_vec
     ;;
diff -uNr binutils-2.21.1.orig/bfd/elf32-ppc.c binutils-2.21.1-addhaiku/bfd/elf32-ppc.c
--- binutils-2.21.1.orig/bfd/elf32-ppc.c	2011-06-27 02:39:04.000000000 -0500
+++ binutils-2.21.1-addhaiku/bfd/elf32-ppc.c	2011-08-23 19:21:47.000000000 -0500
@@ -8962,7 +8962,7 @@
 #define ELF_ARCH		bfd_arch_powerpc
 #define ELF_TARGET_ID		PPC32_ELF_DATA
 #define ELF_MACHINE_CODE	EM_PPC
-#ifdef __QNXTARGET__
+#if defined(__QNXTARGET__) || defined(__HAIKU_TARGET__)
 #define ELF_MAXPAGESIZE		0x1000
 #else
 #define ELF_MAXPAGESIZE		0x10000
diff -uNr binutils-2.21.1.orig/gas/config/tc-i386.c binutils-2.21.1-addhaiku/gas/config/tc-i386.c
--- binutils-2.21.1.orig/gas/config/tc-i386.c	2011-04-01 07:02:42.000000000 -0500
+++ binutils-2.21.1-addhaiku/gas/config/tc-i386.c	2011-08-23 19:23:48.000000000 -0500
@@ -304,7 +304,8 @@
  	 && !defined (TE_NETWARE)			\
 	 && !defined (TE_FreeBSD)			\
 	 && !defined (TE_DragonFly)			\
-	 && !defined (TE_NetBSD)))
+	 && !defined (TE_NetBSD)			\
+	 && !defined (TE_BeOS)))
 /* This array holds the chars that always start a comment.  If the
    pre-processor is disabled, these aren't very useful.  The option
    --divide will remove '/' from this list.  */
diff -uNr binutils-2.21.1.orig/gas/config/te-beos.h binutils-2.21.1-addhaiku/gas/config/te-beos.h
--- binutils-2.21.1.orig/gas/config/te-beos.h	1969-12-31 18:00:00.000000000 -0600
+++ binutils-2.21.1-addhaiku/gas/config/te-beos.h	2011-08-23 19:21:47.000000000 -0500
@@ -0,0 +1,10 @@
+/* Target environment for BeOS/Haiku.  It is the same as the generic
+   target, except that it arranges via the TE_BeOS define to
+   suppress the use of "/" as a comment character.  Some code in the
+   haiku kernel uses "/" to mean division.  (What a concept!)  */
+#define TE_BeOS 1
+
+#define LOCAL_LABELS_DOLLAR 1
+#define LOCAL_LABELS_FB 1
+
+#include "obj-format.h"
diff -uNr binutils-2.21.1.orig/gas/config/te-haiku.h binutils-2.21.1-addhaiku/gas/config/te-haiku.h
--- binutils-2.21.1.orig/gas/config/te-haiku.h	1969-12-31 18:00:00.000000000 -0600
+++ binutils-2.21.1-addhaiku/gas/config/te-haiku.h	2011-08-23 19:21:47.000000000 -0500
@@ -0,0 +1,10 @@
+/* Target environment for BeOS/Haiku.  It is the same as the generic
+   target, except that it arranges via the TE_BeOS define to
+   suppress the use of "/" as a comment character.  Some code in the
+   haiku kernel uses "/" to mean division.  (What a concept!)  */
+#define TE_BeOS 1
+
+#define LOCAL_LABELS_DOLLAR 1
+#define LOCAL_LABELS_FB 1
+
+#include "obj-format.h"
diff -uNr binutils-2.21.1.orig/gas/configure.tgt binutils-2.21.1-addhaiku/gas/configure.tgt
--- binutils-2.21.1.orig/gas/configure.tgt	2011-04-01 07:02:42.000000000 -0500
+++ binutils-2.21.1-addhaiku/gas/configure.tgt	2011-08-23 19:21:47.000000000 -0500
@@ -126,6 +126,7 @@
 					fmt=coff em=wince-pe ;;
   arm-*-pe | thumb-*-pe)		fmt=coff em=pe ;;
   arm-*-riscix*)			fmt=aout em=riscix ;;
+  arm-*-haiku*)				fmt=elf  em=haiku ;;
 
   avr-*-*)				fmt=elf bfd_gas=yes ;;
 
@@ -177,9 +178,10 @@
   i386-ibm-aix*)			fmt=coff em=i386aix ;;
   i386-sequent-bsd*)			fmt=aout em=dynix ;;
   i386-*-beospe*)			fmt=coff em=pe ;;
-  i386-*-beos*)				fmt=elf ;;
+  i386-*-beos*)				fmt=elf em=beos ;;
   i386-*-coff)				fmt=coff ;;
   i386-*-elf)				fmt=elf ;;
+  i386-*-haiku*)			fmt=elf em=haiku ;;
   i386-*-kaos*)				fmt=elf ;;
   i386-*-bsd*)				fmt=aout em=386bsd ;;
   i386-*-netbsd0.8)			fmt=aout em=386bsd ;;
@@ -270,6 +272,7 @@
   m68k-*-netbsd*)			fmt=aout em=nbsd bfd_gas=yes ;;
   m68k-*-openbsd*)			fmt=aout em=nbsd bfd_gas=yes ;;
   m68k-*-psos*)				fmt=elf em=psos;;
+  m68k-*-haiku*)			fmt=elf em=haiku ;;
 
   mep-*-elf)				fmt=elf ;;
 
@@ -296,6 +299,7 @@
   mips-*-elf* | mips-*-rtems*)		fmt=elf ;;
   mips-*-netbsd*)			fmt=elf em=tmips ;;
   mips-*-openbsd*)			fmt=elf em=tmips ;;
+  mips*-*-haiku*)			fmt=elf endian=little em=haiku ;;
 
   mmix-*-*)				fmt=elf ;;
 
@@ -329,9 +333,10 @@
   ppc-*-aix5.[01])			fmt=coff em=aix5 ;;
   ppc-*-aix[5-9].*)			fmt=coff em=aix5 ;;
   ppc-*-aix*)				fmt=coff ;;
-  ppc-*-beos*)				fmt=coff ;;
+  ppc-*-beos*)				fmt=coff em=beos ;;
   ppc-*-*n*bsd* | ppc-*-elf*)		fmt=elf ;;
   ppc-*-eabi* | ppc-*-sysv4*)		fmt=elf ;;
+  ppc-*-haiku*)				fmt=elf em=haiku ;;
   ppc-*-linux-*)			fmt=elf em=linux ;;
   ppc-*-solaris*)			fmt=elf em=solaris ;;
   ppc-*-rtems*)				fmt=elf ;;
diff -uNr binutils-2.21.1.orig/include/binary-io.h binutils-2.21.1-addhaiku/include/binary-io.h
--- binutils-2.21.1.orig/include/binary-io.h	2008-08-24 23:36:03.000000000 -0500
+++ binutils-2.21.1-addhaiku/include/binary-io.h	2011-08-23 19:21:47.000000000 -0500
@@ -30,8 +30,8 @@
 # define O_BINARY _O_BINARY
 # define O_TEXT _O_TEXT
 #endif
-#ifdef __BEOS__
-  /* BeOS 5 has O_BINARY and O_TEXT, but they have no effect.  */
+#if defined(__BEOS__) || defined(__HAIKU__)
+  /* BeOS 5 and Haiku R1 have O_BINARY and O_TEXT, but they have no effect.  */
 # undef O_BINARY
 # undef O_TEXT
 #endif
diff -uNr binutils-2.21.1.orig/intl/loadmsgcat.c binutils-2.21.1-addhaiku/intl/loadmsgcat.c
--- binutils-2.21.1.orig/intl/loadmsgcat.c	2006-05-22 10:30:13.000000000 -0500
+++ binutils-2.21.1-addhaiku/intl/loadmsgcat.c	2011-08-23 19:21:47.000000000 -0500
@@ -480,8 +480,8 @@
 # define O_BINARY _O_BINARY
 # define O_TEXT _O_TEXT
 #endif
-#ifdef __BEOS__
-  /* BeOS 5 has O_BINARY and O_TEXT, but they have no effect.  */
+#if defined(__BEOS__) || defined(__HAIKU__)
+  /* BeOS 5 and Haiku R1 have O_BINARY and O_TEXT, but they have no effect.  */
 # undef O_BINARY
 # undef O_TEXT
 #endif
diff -uNr binutils-2.21.1.orig/ld/Makefile.am binutils-2.21.1-addhaiku/ld/Makefile.am
--- binutils-2.21.1.orig/ld/Makefile.am	2011-03-16 03:37:30.000000000 -0500
+++ binutils-2.21.1-addhaiku/ld/Makefile.am	2011-08-23 19:35:06.000000000 -0500
@@ -141,6 +141,7 @@
 	earmcoff.c \
 	earmelf.c \
 	earmelf_fbsd.c \
+	earmelf_haiku.c \
 	earmelf_linux.c \
 	earmelf_linux_eabi.c \
 	earmelf_nbsd.c \
@@ -241,7 +242,10 @@
 	eelf_i386_be.c \
 	eelf_i386_chaos.c \
 	eelf_i386_fbsd.c \
+	eelf_i386_haiku.c \
 	eelf_i386_ldso.c \
+	eelf_ppc_haiku.c \
+	eelf_mipsel_haiku.c \
 	eelf_i386_sol2.c \
 	eelf_i386_vxworks.c \
 	eelf_s390.c \
@@ -670,6 +674,10 @@
   $(ELF_DEPS) $(srcdir)/emultempl/armelf.em \
   $(srcdir)/scripttempl/elf.sc ${GEN_DEPENDS}
 	${GENSCRIPTS} armelf_fbsd "$(tdir_armelf_fbsd)"
+earmelf_haiku.c: $(srcdir)/emulparams/armelf_haiku.sh \
+  $(srcdir)/emultempl/elf32.em $(srcdir)/emultempl/armelf.em \
+  $(srcdir)/scripttempl/elf.sc ${GEN_DEPENDS}
+	${GENSCRIPTS} armelf_haiku "$(tdir_armelf_haiku)"
 earmelf_linux.c: $(srcdir)/emulparams/armelf_linux.sh \
   $(ELF_DEPS) $(srcdir)/emultempl/armelf.em \
   $(srcdir)/scripttempl/elf.sc ${GEN_DEPENDS}
@@ -1083,9 +1091,21 @@
   $(srcdir)/emulparams/elf_i386.sh \
   $(ELF_DEPS) $(srcdir)/scripttempl/elf.sc ${GEN_DEPENDS}
 	${GENSCRIPTS} elf_i386_fbsd "$(tdir_elf_i386_fbsd)"
+eelf_i386_haiku.c: $(srcdir)/emulparams/elf_i386_haiku.sh \
+  $(srcdir)/emultempl/elf32.em \
+  $(ELF_DEPS) $(srcdir)/scripttempl/elf.sc ${GEN_DEPENDS}
+	${GENSCRIPTS} elf_i386_haiku "$(tdir_elf_i386_haiku)"
 eelf_i386_ldso.c: $(srcdir)/emulparams/elf_i386_ldso.sh \
   $(ELF_DEPS) $(srcdir)/scripttempl/elf.sc ${GEN_DEPENDS}
 	${GENSCRIPTS} elf_i386_ldso "$(tdir_elf_i386_ldso)"
+eelf_ppc_haiku.c: $(srcdir)/emulparams/elf_ppc_haiku.sh \
+  $(srcdir)/emultempl/elf32.em \
+  $(ELF_DEPS) $(srcdir)/scripttempl/elf.sc ${GEN_DEPENDS}
+	${GENSCRIPTS} elf_ppc_haiku "$(tdir_elf_ppc_haiku)"
+eelf_mipsel_haiku.c: $(srcdir)/emulparams/elf_mipsel_haiku.sh \
+  $(srcdir)/emultempl/elf32.em \
+  $(ELF_DEPS) $(srcdir)/scripttempl/elf.sc ${GEN_DEPENDS}
+	${GENSCRIPTS} elf_mipsel_haiku "$(tdir_elf_mipsel_haiku)"
 eelf_i386_sol2.c: $(srcdir)/emulparams/elf_i386_sol2.sh \
   $(srcdir)/emulparams/solaris2.sh \
   $(srcdir)/emultempl/solaris2.em \
diff -uNr binutils-2.21.1.orig/ld/Makefile.in binutils-2.21.1-addhaiku/ld/Makefile.in
--- binutils-2.21.1.orig/ld/Makefile.in	2011-03-16 03:37:30.000000000 -0500
+++ binutils-2.21.1-addhaiku/ld/Makefile.in	2011-08-23 19:36:22.000000000 -0500
@@ -446,6 +446,7 @@
 	earmcoff.c \
 	earmelf.c \
 	earmelf_fbsd.c \
+	earmelf_haiku.c \
 	earmelf_linux.c \
 	earmelf_linux_eabi.c \
 	earmelf_nbsd.c \
@@ -546,7 +547,10 @@
 	eelf_i386_be.c \
 	eelf_i386_chaos.c \
 	eelf_i386_fbsd.c \
+	eelf_i386_haiku.c \
 	eelf_i386_ldso.c \
+	eelf_ppc_haiku.c \
+	eelf_mipsel_haiku.c \
 	eelf_i386_sol2.c \
 	eelf_i386_vxworks.c \
 	eelf_s390.c \
@@ -2105,6 +2109,10 @@
   $(ELF_DEPS) $(srcdir)/emultempl/armelf.em \
   $(srcdir)/scripttempl/elf.sc ${GEN_DEPENDS}
 	${GENSCRIPTS} armelf_fbsd "$(tdir_armelf_fbsd)"
+earmelf_haiku.c: $(srcdir)/emulparams/armelf_haiku.sh \
+  $(srcdir)/emultempl/elf32.em $(srcdir)/emultempl/armelf.em \
+  $(srcdir)/scripttempl/elf.sc ${GEN_DEPENDS}
+	${GENSCRIPTS} armelf_haiku "$(tdir_armelf_haiku)"
 earmelf_linux.c: $(srcdir)/emulparams/armelf_linux.sh \
   $(ELF_DEPS) $(srcdir)/emultempl/armelf.em \
   $(srcdir)/scripttempl/elf.sc ${GEN_DEPENDS}
@@ -2518,9 +2526,21 @@
   $(srcdir)/emulparams/elf_i386.sh \
   $(ELF_DEPS) $(srcdir)/scripttempl/elf.sc ${GEN_DEPENDS}
 	${GENSCRIPTS} elf_i386_fbsd "$(tdir_elf_i386_fbsd)"
+eelf_i386_haiku.c: $(srcdir)/emulparams/elf_i386_haiku.sh \
+  $(srcdir)/emultempl/elf32.em \
+  $(ELF_DEPS)  $(srcdir)/scripttempl/elf.sc ${GEN_DEPENDS}
+	${GENSCRIPTS} elf_i386_haiku "$(tdir_elf_i386_haiku)"
 eelf_i386_ldso.c: $(srcdir)/emulparams/elf_i386_ldso.sh \
   $(ELF_DEPS) $(srcdir)/scripttempl/elf.sc ${GEN_DEPENDS}
 	${GENSCRIPTS} elf_i386_ldso "$(tdir_elf_i386_ldso)"
+eelf_mipsel_haiku.c:  $(srcdir)/emulparams/elf_mipsel_haiku.sh \
+  $(srcdir)/emultempl/elf32.em \
+  $(ELF_DEPS) $(srcdir)/scripttempl/elf.sc ${GEN_DEPENDS}
+	${GENSCRIPTS} elf_mipsel_haiku "$(tdir_elf_mipsel_haiku)"
+eelf_ppc_haiku.c: $(srcdir)/emulparams/elf_ppc_haiku.sh \
+  $(srcdir)/emultempl/elf32.em \
+  $(ELF_DEPS) $(srcdir)/scripttempl/elf.sc ${GEN_DEPENDS}
+	${GENSCRIPTS} elf_ppc_haiku "$(tdir_elf_ppc_haiku)"
 eelf_i386_sol2.c: $(srcdir)/emulparams/elf_i386_sol2.sh \
   $(srcdir)/emulparams/solaris2.sh \
   $(srcdir)/emultempl/solaris2.em \
diff -uNr binutils-2.21.1.orig/ld/configure.tgt binutils-2.21.1-addhaiku/ld/configure.tgt
--- binutils-2.21.1.orig/ld/configure.tgt	2011-04-01 07:03:54.000000000 -0500
+++ binutils-2.21.1-addhaiku/ld/configure.tgt	2011-08-23 19:21:47.000000000 -0500
@@ -97,6 +97,7 @@
 			;;
 arm-*-vxworks)		targ_emul=armelf_vxworks ;;
 arm*-*-conix*)		targ_emul=armelf ;;
+arm*-*-haiku*)		targ_emul=armelf_haiku; targ_extra_emuls=armelf ;;
 thumb-*-linux-* | thumb-*-uclinux*)	targ_emul=armelf_linux; targ_extra_emuls=armelf ;;
 strongarm-*-coff)	targ_emul=armcoff ;;
 strongarm-*-elf)	targ_emul=armelf ;;
@@ -285,6 +286,9 @@
  			targ_extra_ofiles="deffilep.o pe-dll.o" ;;
 i[3-7]86-*-beospe*)	targ_emul=i386beos ;;
 i[3-7]86-*-beos*)	targ_emul=elf_i386_be ;;
+i[3-7]86-*-haiku*)	targ_emul=elf_i386_haiku ;;
+x86_64-*-haiku*)	targ_emul=elf_x86_64
+			targ_extra_emuls=elf_i386_haiku ;;
 i[3-7]86-*-vxworks*)	targ_emul=elf_i386_vxworks ;;
 i[3-7]86-*-chaos)	targ_emul=elf_i386_chaos
 			;;
@@ -356,7 +360,9 @@
 			targ_extra_emuls="m68kelfnbsd m68k4knbsd" ;;
 m68*-*-psos*)		targ_emul=m68kpsos ;;
 m68*-*-rtemscoff*)	targ_emul=m68kcoff ;;
-m68*-*-rtems*)		targ_emul=m68kelf
+m68*-*-rtems*)		targ_emul=m68kelf ;;
+m68*-*-haiku*)		targ_emul=m68kelf
+			targ_extra_emuls=m68kcoff
 			;;
 m8*-*-*)		targ_emul=m88kbcs
 			;;
@@ -382,6 +388,9 @@
 mips*el-*-netbsd*)	targ_emul=elf32ltsmip
 			targ_extra_emuls="elf32btsmip elf64ltsmip elf64btsmip"
 			;;
+mips*el-*-haiku*)	targ_emul=elf_mipsel_haiku
+			targ_extra_emuls="elf32ltsmip elf32btsmip elf32ltsmipn32 elf64ltsmip elf32btsmipn32 elf64btsmip" 
+			;;
 mips*-*-netbsd*)	targ_emul=elf32btsmip
 			targ_extra_emuls="elf32ltsmip elf64btsmip elf64ltsmip"
   			;;
@@ -502,6 +511,7 @@
 powerpc-*-aix[5-9]*)	targ_emul=aix5ppc ;;
 powerpc-*-aix*)		targ_emul=aixppc ;;
 powerpc-*-beos*)	targ_emul=aixppc ;;
+powerpc-*-haiku*)	targ_emul=elf_ppc_haiku ;;
 powerpc-*-windiss*)	targ_emul=elf32ppcwindiss ;;
 powerpc-*-lynxos*)	targ_emul=ppclynx ;;
 rs6000-*-aix[5-9]*)	targ_emul=aix5rs6 ;;
diff -uNr binutils-2.21.1.orig/ld/emulparams/armelf_haiku.sh binutils-2.21.1-addhaiku/ld/emulparams/armelf_haiku.sh
--- binutils-2.21.1.orig/ld/emulparams/armelf_haiku.sh	1969-12-31 18:00:00.000000000 -0600
+++ binutils-2.21.1-addhaiku/ld/emulparams/armelf_haiku.sh	2011-08-23 19:21:47.000000000 -0500
@@ -0,0 +1,24 @@
+ARCH=arm
+SCRIPT_NAME=elf
+OUTPUT_FORMAT="elf32-littlearm"
+BIG_OUTPUT_FORMAT="elf32-bigarm"
+LITTLE_OUTPUT_FORMAT="elf32-littlearm"
+MAXPAGESIZE=0x8000
+COMMONPAGESIZE=0x1000
+TEMPLATE_NAME=elf32
+EXTRA_EM_FILE=armelf
+GENERATE_SHLIB_SCRIPT=yes
+GENERATE_PIE_SCRIPT=yes
+
+DATA_START_SYMBOLS='__data_start = . ;';
+OTHER_TEXT_SECTIONS='*(.glue_7t) *(.glue_7)'
+OTHER_BSS_SYMBOLS='__bss_start__ = .;'
+OTHER_BSS_END_SYMBOLS='_bss_end__ = . ; __bss_end__ = . ;'
+OTHER_END_SYMBOLS='__end__ = . ;'
+OTHER_SECTIONS='.note.gnu.arm.ident 0 : { KEEP (*(.note.gnu.arm.ident)) }'
+
+TEXT_START_ADDR=0x00008000
+TARGET2_TYPE=got-rel
+
+# ARM does not support .s* sections.
+NO_SMALL_DATA=yes
diff -uNr binutils-2.21.1.orig/ld/emulparams/elf_i386_haiku.sh binutils-2.21.1-addhaiku/ld/emulparams/elf_i386_haiku.sh
--- binutils-2.21.1.orig/ld/emulparams/elf_i386_haiku.sh	1969-12-31 18:00:00.000000000 -0600
+++ binutils-2.21.1-addhaiku/ld/emulparams/elf_i386_haiku.sh	2011-08-23 19:21:47.000000000 -0500
@@ -0,0 +1,11 @@
+SCRIPT_NAME=elf
+OUTPUT_FORMAT="elf32-i386"
+TEXT_START_ADDR=0x200000
+NONPAGED_TEXT_START_ADDR=0x200000
+MAXPAGESIZE=0x1000
+ARCH=i386
+MACHINE=
+NOP=0x90909090
+TEMPLATE_NAME=elf32
+GENERATE_SHLIB_SCRIPT=yes
+NO_SMALL_DATA=yes
diff -uNr binutils-2.21.1.orig/ld/emulparams/elf_mipsel_haiku.sh binutils-2.21.1-addhaiku/ld/emulparams/elf_mipsel_haiku.sh
--- binutils-2.21.1.orig/ld/emulparams/elf_mipsel_haiku.sh	1969-12-31 18:00:00.000000000 -0600
+++ binutils-2.21.1-addhaiku/ld/emulparams/elf_mipsel_haiku.sh	2011-08-23 19:21:47.000000000 -0500
@@ -0,0 +1,2 @@
+. ${srcdir}/emulparams/elf32lmip.sh
+
diff -uNr binutils-2.21.1.orig/ld/emulparams/elf_ppc_haiku.sh binutils-2.21.1-addhaiku/ld/emulparams/elf_ppc_haiku.sh
--- binutils-2.21.1.orig/ld/emulparams/elf_ppc_haiku.sh	1969-12-31 18:00:00.000000000 -0600
+++ binutils-2.21.1-addhaiku/ld/emulparams/elf_ppc_haiku.sh	2011-08-23 19:21:47.000000000 -0500
@@ -0,0 +1,20 @@
+SCRIPT_NAME=elf
+OUTPUT_FORMAT="elf32-powerpc"
+TEXT_START_ADDR=0x200000
+NONPAGED_TEXT_START_ADDR=0x200000
+MAXPAGESIZE=0x1000
+ARCH=powerpc
+MACHINE=
+NOP=0x60000000
+TEMPLATE_NAME=elf32
+GENERATE_SHLIB_SCRIPT=yes
+BSS_PLT=
+OTHER_RELRO_SECTIONS="
+  .fixup        ${RELOCATING-0} : { *(.fixup) }
+  .got1         ${RELOCATING-0} : { *(.got1) }
+  .got2         ${RELOCATING-0} : { *(.got2) }
+"
+OTHER_GOT_RELOC_SECTIONS="
+  .rela.got1         ${RELOCATING-0} : { *(.rela.got1) }
+  .rela.got2         ${RELOCATING-0} : { *(.rela.got2) }
+"
diff -uNr binutils-2.21.1.orig/libtool.m4 binutils-2.21.1-addhaiku/libtool.m4
--- binutils-2.21.1.orig/libtool.m4	2010-01-09 15:11:31.000000000 -0600
+++ binutils-2.21.1-addhaiku/libtool.m4	2011-08-23 19:21:47.000000000 -0500
@@ -2337,6 +2337,15 @@
   hardcode_into_libs=yes
   ;;
 
+haiku*)
+  library_names_spec='${libname}.so'
+  dynamic_linker="$host_os ld.so"
+  shlibpath_var=LIBRARY_PATH
+  lt_cv_dlopen="load_add_on"
+  lt_cv_dlopen_libs=
+  lt_cv_dlopen_self=yes
+  ;;
+
 hpux9* | hpux10* | hpux11*)
   # Give a soname corresponding to the major version so that dld.sl refuses to
   # link against other versions.
@@ -3046,6 +3055,10 @@
   lt_cv_deplibs_check_method=pass_all
   ;;
 
+haiku*)
+  lt_cv_deplibs_check_method=pass_all
+  ;;
+
 hpux10.20* | hpux11*)
   lt_cv_file_magic_cmd=/usr/bin/file
   case $host_cpu in
